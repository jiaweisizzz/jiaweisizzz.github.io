<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    
  <title>ä¸»æµçš„golang clickhouseå®¢æˆ·ç«¯å†™å…¥æ€§èƒ½æµ‹è¯• | JARVIS</title>
  <meta name="author" content="jarvis">
  <meta name="description" content="Clickhouse(ä»¥ä¸‹ç®€ç§°ck)æ˜¯æˆ˜æ–—æ°‘æ—Yandexå…¬å¸åœ¨2016å¹´å¼€æºçš„ä¸“ä¸ºåœ¨çº¿æ•°æ®åˆ†æè€Œè®¾è®¡çš„é«˜æ€§èƒ½åˆ—å¼å­˜å‚¨æ•°æ®åº“ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯">
  <meta name="keywords" content="ck ,clickhouse">

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ä¸»æµçš„golang clickhouseå®¢æˆ·ç«¯å†™å…¥æ€§èƒ½æµ‹è¯•"/>
<meta name="twitter:description" content="Clickhouse(ä»¥ä¸‹ç®€ç§°ck)æ˜¯æˆ˜æ–—æ°‘æ—Yandexå…¬å¸åœ¨2016å¹´å¼€æºçš„ä¸“ä¸ºåœ¨çº¿æ•°æ®åˆ†æè€Œè®¾è®¡çš„é«˜æ€§èƒ½åˆ—å¼å­˜å‚¨æ•°æ®åº“ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯"/>

  <meta property="og:title" content="ä¸»æµçš„golang clickhouseå®¢æˆ·ç«¯å†™å…¥æ€§èƒ½æµ‹è¯•" />
<meta property="og:description" content="Clickhouse(ä»¥ä¸‹ç®€ç§°ck)æ˜¯æˆ˜æ–—æ°‘æ—Yandexå…¬å¸åœ¨2016å¹´å¼€æºçš„ä¸“ä¸ºåœ¨çº¿æ•°æ®åˆ†æè€Œè®¾è®¡çš„é«˜æ€§èƒ½åˆ—å¼å­˜å‚¨æ•°æ®åº“ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jiaweisizzz.github.io/posts/go_clickhouse%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-03-10T00:00:00+00:00" />

  <link rel="stylesheet" href="/css/bootstrap.min.css"  crossorigin="anonymous">
  
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="/sass/main.css">

  <link rel="stylesheet" href="/zoomjs/zoom.min.css">

  <script src=/js/lazysizes.min.js></script>

  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  

</head>



<body ontouchstart="">
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top ">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jiaweisizzz.github.io">JARVIS</a>
    </div>
    
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li><a href="/" title="Home">Home</a></li>
          
          <li><a href="/archive/" title="Archive">Archive</a></li>
          
          <li><a href="/tags/" title="Tags">Tags</a></li>
          
          <li><a href="/about/" title="About">About</a></li>
          
          <li><a href="" title=""></a></li>
          

          <li class="search-icon">
            <a href="javascript:void(0)">
              <i class="fa fa-search"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
  </div>
  
</nav>
<script>
  
  
  
  var $body = document.body;
  var $toggle = document.querySelector(".navbar-toggle");
  var $navbar = document.querySelector("#huxblog_navbar");
  var $collapse = document.querySelector(".navbar-collapse");

  var __HuxNav__ = {
    close: function () {
      $navbar.className = " ";
      
      setTimeout(function () {
        
        if ($navbar.className.indexOf("in") < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    },
    open: function () {
      $collapse.style.height = "auto";
      $navbar.className += " in";
    },
  };

  
  $toggle.addEventListener("click", function (e) {
    if ($navbar.className.indexOf("in") > 0) {
      __HuxNav__.close();
    } else {
      __HuxNav__.open();
    }
  });

  

  document.addEventListener("click", function (e) {
    if (e.target == $toggle) return;
    if (e.target.className == "icon-bar") return;
    __HuxNav__.close();
  });
</script>
  
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

  
  


<style type="text/css">
  header.intro-header {
    position: relative;
    background-image: url('/img/go_clickhosue/header.jpg');
  }
</style>

<header class="intro-header ">

  <div class="header-mask"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <div class="tags">
            
            <a class="tag" href="/tags/golang/" title="golang">golang</a>
            
            <a class="tag" href="/tags/clickhouse/" title="clickhouse">clickhouse</a>
            
          </div>
          <h1>ä¸»æµçš„golang clickhouseå®¢æˆ·ç«¯å†™å…¥æ€§èƒ½æµ‹è¯•</h1>
          <h2 class="subheading">clickhouse æ€§èƒ½å¯¹æ¯”</h2>
          <span class="meta">
            Posted by  jarvis 
            on Fri, Mar 10, 2023
          </span>
        </div>
      </div>
    </div>
  </div>
</header>


  


<article>
  <div class="container">
    <div class="row">

      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              post-container">
        <p>Clickhouse(ä»¥ä¸‹ç®€ç§°ck)æ˜¯æˆ˜æ–—æ°‘æ—Yandexå…¬å¸åœ¨2016å¹´å¼€æºçš„ä¸“ä¸ºåœ¨çº¿æ•°æ®åˆ†æè€Œè®¾è®¡çš„é«˜æ€§èƒ½åˆ—å¼å­˜å‚¨æ•°æ®åº“ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»ckå®˜ç½‘å­¦ä¹ ä¸€ä¸‹ã€‚
ç”±äºåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œéœ€è¦æ”¯æ’‘å¤§æµé‡ä¸‹çš„ckå†™å…¥ï¼Œæ‰€ä»¥æœ€è¿‘å‡ å¤©æµ‹è¯•äº†ä¸€ä¸‹ä½¿ç”¨goå®¢æˆ·ç«¯çš„ckå†™å…¥æ€§èƒ½ï¼Œä¸»æµçš„ckå®¢æˆ·ç«¯æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>clickhouse-go</li>
<li>ch-go</li>
<li>database/sql</li>
<li>sqlx</li>
<li>gorm</li>
</ul>
<p>Clickhouseå®˜æ–¹æ¨èäº†ä¸¤ç§å®¢æˆ·ç«¯ï¼Œåˆ†åˆ«æ˜¯clickhouse-goå’Œch-goï¼Œclickhouse-goæ˜¯æ›´é«˜çº§åˆ«çš„apiï¼Œä½†æ˜¯é€‰æ‹©å“ªç§éœ€è¦æ ¹æ®ä½¿ç”¨çš„æ¨¡å¼å’Œå¯¹æ€§èƒ½çš„éœ€æ±‚ï¼Œå¯¹äºæ¯ç§’ç™¾ä¸‡çº§åˆ«çš„æ’å…¥ï¼Œæ›´æ¨èä½¿ç”¨ch-goï¼Œå¯¹äºä½ååé‡å’Œä¸“æ³¨äºæ•°æ®åˆ†ææ¥è¯´ï¼Œæ¨èä½¿ç”¨å‰è€…ã€‚ä»¥ä¸‹æ˜¯ckå®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€æ®µè¯ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚</p>
<blockquote>
<p>Selecting a client library depends on your usage patterns and need for optimal performance. For insert heavy use cases, where millions of inserts are required per second, we recommend using the low level client <a href="https://github.com/ClickHouse/ch-go" target="_blank">ch-go</a>. This client avoids the associated overhead of pivoting the data from a row-orientated format to columns, as the ClickHouse native format requires. Furthermore, it avoids any reflection or use of the <code>interface{}</code> (<code>any</code>) type to simplify usage.</p>
<p>For query workloads focused on aggregations or lower throughput insert workloads, the <a href="https://github.com/ClickHouse/clickhouse-go" target="_blank">clickhouse-go</a> provides a familiar <code>database/sql</code> interface and more straightforward row semantics. Users can also optionally use HTTP for the transport protocol and take advantage of helper functions to marshal rows to and from structs.</p>
</blockquote>
<p>ä½†å¼€å‘ä¸èƒ½å•å‡­æ–‡æ¡£æ¨èï¼Œè¦æ ¹æ®å®é™…æƒ…å†µï¼Œåšæ€§èƒ½æµ‹è¯•ä¹‹åï¼Œæ ¹æ®æµ‹è¯•ç»“æœé€‰æ‹©æœ€ä¼˜çš„æ–¹æ¡ˆã€‚åœ¨åšæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œç¬”è€…æ‰€ç”¨çš„goç‰ˆæœ¬ä¸º1.19.6ï¼Œå› ä¸ºclickhouse-goå¯¹goç‰ˆæœ¬æœ‰è¦æ±‚ï¼š</p>
<table>
<thead>
<tr>
<th>Client Version</th>
<th>Golang Versions</th>
</tr>
</thead>
<tbody>
<tr>
<td>=&gt; 2.0 &lt;= 2.2</td>
<td>1.17, 1.18</td>
</tr>
<tr>
<td>&gt;= 2.3</td>
<td>1.18.4+, 1.19</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="æ€§èƒ½æµ‹è¯•">æ€§èƒ½æµ‹è¯•<a class="anchorjs-link" href="#%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95"></a></h2><p>æ‰€æœ‰çš„æµ‹è¯•éƒ½æ˜¯ç”¨çš„åŒä¸€ä¸ªæ•°æ®æ ·æœ¬ï¼Œå•æ¡æ•°æ®1460å­—èŠ‚å¤§çº¦1.4KBï¼Œæ•°æ®åº“è¡¨å­—æ®µ689ä¸ªï¼Œå†™å…¥å­—æ®µ32ä¸ªï¼Œæ¯æ¬¡æœ€å°‘å†™å…¥80000æ¡æ•°æ®ï¼Œå› ä¸ºckå®˜æ–¹è¯´ä¸ºäº†ä¿è¯å†™å…¥çš„æ€§èƒ½ï¼Œ1KBå·¦å³çš„æ•°æ®åœ¨5w-20w/sï¼Œä¸è¿‡å†™å…¥çš„æ€§èƒ½è·Ÿå¾ˆå¤šå› ç´ éƒ½æŒ‚é’©ï¼Œæ¯”å¦‚å­—æ®µçš„å¤šå°‘ï¼Œè¿æ¥æ¨¡å¼ç­‰ç­‰ã€‚ç”¨çš„æµ‹è¯•æœºå™¨æ˜¯Linuxç³»ç»Ÿï¼Œ48æ ¸ã€‚æµ‹è¯•ç»“æœæˆ‘ä»¬ç”¨Grafanaå’ŒPrometheusæ¥ç›‘æ§ã€‚æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼æ¥æ¥æ§åˆ¶è¿æ¥ã€æ•°æ®é‡å’Œåç¨‹æ•°é‡ç­‰ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>	host = flag.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;host&#34;</span>, <span style="color:#f1fa8c">&#34;locakhouse:9000&#34;</span>, <span style="color:#f1fa8c">&#34;clickhouse host&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>	user = flag.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;user&#34;</span>, <span style="color:#f1fa8c">&#34;root&#34;</span>, <span style="color:#f1fa8c">&#34;clichouse user&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>	pass = flag.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;password&#34;</span>, <span style="color:#f1fa8c">&#34;123456&#34;</span>, <span style="color:#f1fa8c">&#34;clickhouse password&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>	db = flag.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;db&#34;</span>, <span style="color:#f1fa8c">&#34;test&#34;</span>, <span style="color:#f1fa8c">&#34;clickhouse database&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>	g = flag.<span style="color:#50fa7b">Int</span>(<span style="color:#f1fa8c">&#34;g&#34;</span>, <span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">&#34;write goroutine&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>	batch = flag.<span style="color:#50fa7b">Int</span>(<span style="color:#f1fa8c">&#34;batch&#34;</span>, <span style="color:#bd93f9">100000</span>, <span style="color:#f1fa8c">&#34;clickhouse batch&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>	tb = flag.<span style="color:#50fa7b">String</span>(<span style="color:#f1fa8c">&#34;tb&#34;</span>, <span style="color:#f1fa8c">&#34;event&#34;</span>, <span style="color:#f1fa8c">&#34;clickhouse table&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>	debug = flag.<span style="color:#50fa7b">Bool</span>(<span style="color:#f1fa8c">&#34;debug&#34;</span>, <span style="color:#ff79c6">false</span>, <span style="color:#f1fa8c">&#34;clickhouse debug&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>	flag.<span style="color:#50fa7b">Parse</span>()
</span></span></code></pre></div><h3 id="clickhouse-gohttpsgithubcomclickhouseclickhouse-go"><a href="https://github.com/ClickHouse/clickhouse-go" target="_blank">Clickhouse-go</a><a class="anchorjs-link" href="#clickhouse-gohttpsgithubcomclickhouseclickhouse-go"></a></h3><p>clickhouse-goæœ‰ä¸¤ä¸ªç‰ˆæœ¬v1å’Œv2ï¼Œä»å®˜æ–¹benchmarkç»“æœæ¥çœ‹ï¼Œv2ç‰ˆæœ¬çš„æ€§èƒ½è¦æ¯”v1ç‰ˆæœ¬çš„æ€§èƒ½å¥½ï¼Œæœ¬ç€ç”¨æ–°ä¸ç”¨æ—§çš„åŸåˆ™ğŸ˜„ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨v2ç‰ˆæœ¬çš„å¼€å§‹æµ‹è¯•ã€‚æœ‰ä¸¤ç§æ‰¹é‡å†™å…¥æ–¹å¼ï¼Œä¸€ç§æ˜¯æœ¬æœºçš„apiï¼Œä¸€ç§æ˜¯é€šè¿‡å­—æ®µæ˜ å°„æ‰¹é‡å†™å…¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ç§æ–¹å¼ã€‚</p>
<h4 id="write-by-clickhouse-api">Write by clickhouse api<a class="anchorjs-link" href="#write-by-clickhouse-api"></a></h4><p>é¦–å…ˆéœ€è¦å»ºç«‹è¿æ¥ï¼Œç„¶åæ ¹æ®å‘½ä»¤è¡Œå‚æ•°å¯åŠ¨å†™å…¥çš„åç¨‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>	conn, err <span style="color:#ff79c6">:=</span> clickhouse.<span style="color:#50fa7b">Open</span>(<span style="color:#ff79c6">&amp;</span>clickhouse.Options{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>		Addr: []<span style="color:#8be9fd">string</span>{<span style="color:#ff79c6">*</span>host},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>		Auth: clickhouse.Auth{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>			Database: <span style="color:#ff79c6">*</span>db,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>			Username: <span style="color:#ff79c6">*</span>user,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>			Password: <span style="color:#ff79c6">*</span>pass,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>		},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>		Settings: clickhouse.Settings{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>			<span style="color:#f1fa8c">&#34;max_execution_time&#34;</span>: <span style="color:#bd93f9">60</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>		},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>		MaxOpenConns: <span style="color:#bd93f9">50</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>		MaxIdleConns: <span style="color:#bd93f9">10</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>		DialTimeout:  <span style="color:#bd93f9">5</span> <span style="color:#ff79c6">*</span> time.Second,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>		Debug:        <span style="color:#ff79c6">*</span>debug,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>	})
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>		<span style="color:#8be9fd;font-style:italic">panic</span>(<span style="color:#50fa7b">any</span>(err))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> conn.<span style="color:#50fa7b">Ping</span>(context.<span style="color:#50fa7b">Background</span>()); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>		<span style="color:#8be9fd;font-style:italic">panic</span>(<span style="color:#50fa7b">any</span>(err))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>	<span style="color:#ff79c6">for</span> i<span style="color:#ff79c6">:=</span><span style="color:#bd93f9">0</span>; i&lt;<span style="color:#ff79c6">*</span>g; i<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>		<span style="color:#ff79c6">go</span> <span style="color:#8be9fd;font-style:italic">func</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>			<span style="color:#ff79c6">for</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>				<span style="color:#50fa7b">insert</span>(conn, <span style="color:#ff79c6">*</span>batch)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>			}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>		}()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>	}
</span></span></code></pre></div><p>å†™å…¥çš„è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆéœ€è¦è§£ææˆ‘ä»¬çš„æ’å…¥è¯­å¥å¾—åˆ°ä¸€ä¸ªbatchï¼Œç„¶åå°†è¿™ä¸€æ‰¹çš„æ•°æ®è¿½åŠ åˆ°batchä¸­ï¼Œæœ€åé€šè¿‡Sendæ–¹æ³•å°†æ•°æ®å†™å…¥åˆ°ckï¼Œæ€»ä½“æ¥è¯´çœŸæ­£çš„å†™å…¥æ˜¯åœ¨Sendä¸­å®ç°çš„ï¼Œåœ¨æ­¤ä¹‹å‰çš„æ“ä½œéƒ½ä¼šæ”¾åˆ°å†…å­˜ä¸­å¤„ç†ã€‚æœ€åé€šè¿‡æ•´ä½“ç”¨æ—¶è·Ÿæ•°æ®é‡è®¡ç®—å¾—å‡ºä¸€ä¸ªé€Ÿç‡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">insert</span>(conn driver.Conn, batch <span style="color:#8be9fd">int</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>	start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	ctx <span style="color:#ff79c6">:=</span> context.<span style="color:#50fa7b">Background</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	bt, err <span style="color:#ff79c6">:=</span> conn.<span style="color:#50fa7b">PrepareBatch</span>(ctx, data.InsertSql)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>		log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	s <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; batch; i<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>		err <span style="color:#ff79c6">:=</span> bt.<span style="color:#50fa7b">Append</span>(data.InsertData.Ccollectorip, data.InsertData.Cdevip, data.InsertData.Cdevtype, data.InsertData.Cdstip, data.InsertData.Ceventmsg,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>			data.InsertData.Ceventname, data.InsertData.Ceventtype, data.InsertData.Cflowdir, data.InsertData.Cobject, data.InsertData.Coperation,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>			data.InsertData.Csrcip, data.InsertData.Csrclogtype, data.InsertData.LogypeTag, data.InsertData.Manufacturer, data.InsertData.Reason,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>			data.InsertData.Iappprotocol, data.InsertData.Icollecttype, data.InsertData.Idstport, data.InsertData.Ieventlevel, data.InsertData.Imergecount,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>			data.InsertData.Iprotocol, data.InsertData.Isrcport, data.InsertData.Lduration, data.InsertData.Lrecivepack, data.InsertData.Lsendpack,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>			data.InsertData.RequestBodyLen, data.InsertData.ResponseBodyLen, data.InsertData.Lendtime, data.InsertData.Lid, time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e9</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>			data.InsertData.Lrecepttime, data.InsertData.Lstartime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>		<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>			log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>		}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>	e <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>	bt.<span style="color:#50fa7b">Send</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>	end <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;è®°å½•æ•°: %d, è€—æ—¶: %d, å¾ªç¯å‡†å¤‡è€—æ—¶: %d, é€Ÿç‡: %d(æ¡/ç§’) \n&#34;</span>, batch, (end<span style="color:#ff79c6">-</span>start)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, (e<span style="color:#ff79c6">-</span>s)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, <span style="color:#8be9fd;font-style:italic">int64</span>(batch<span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000000</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000</span>)<span style="color:#ff79c6">/</span>(end<span style="color:#ff79c6">-</span>start))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>}
</span></span></code></pre></div><p>æµ‹è¯•ç»“æœï¼š</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/clickhouse-go1.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p>ä»æ‰“å°ç»“æœæ¥çœ‹å·®ä¸å¤šé€Ÿç‡åœ¨6w-7w/sä¹‹é—´ï¼Œå†æ¥çœ‹ä¸€ä¸‹grafanaä¹Ÿæ˜¯å¹³å‡6.5w/så·¦å³ã€‚</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/clickhouse-go2.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p>æœ€ç»ˆç»“æœï¼šå•çº¿ç¨‹ä¸‹ï¼Œclickhouse-goçš„å†™å…¥é€Ÿç‡åœ¨6w/sã€‚</p>
<h4 id="write-by-column">Write by column<a class="anchorjs-link" href="#write-by-column"></a></h4><p>è¿æ¥è·Ÿä¹‹å‰éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå†™å…¥çš„å¤„ç†ç•¥æœ‰åŒºåˆ«ï¼Œéœ€è¦é¢„å…ˆå®šä¹‰æ’å…¥å­—æ®µçš„ç±»å‹ï¼Œæˆ‘ä»¬æå‰å°†æ•°æ®æ”¾åˆ°å®šä¹‰å¥½çš„å­—æ®µä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">var</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>	ccollectorip, cdevip, cdevtype, cdstip, ceventmsg, ceventname, ceventtype, cflowdir, cobject, coperation, csrcip, csrclogtype,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	logtype_tag, manufacturer, reason []<span style="color:#8be9fd">string</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	iappprotocol, icollecttype, idstport, ieventlevel, imergecount, iprotocol, isrcport                                       []<span style="color:#8be9fd">int32</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>	lduration, lrecivepack, lsendpack, request_body_len, response_body_len, lendtime, lid, loccurtime, lrecepttime, lstartime []<span style="color:#8be9fd">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#ff79c6">*</span>batch; i<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>		ccollectorip = <span style="color:#8be9fd;font-style:italic">append</span>(ccollectorip, data.InsertData.Ccollectorip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>		cdevip = <span style="color:#8be9fd;font-style:italic">append</span>(cdevip, data.InsertData.Cdevip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>		cdevtype = <span style="color:#8be9fd;font-style:italic">append</span>(cdevtype, data.InsertData.Cdevtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>		cdstip = <span style="color:#8be9fd;font-style:italic">append</span>(cdstip, data.InsertData.Cdstip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>		ceventmsg = <span style="color:#8be9fd;font-style:italic">append</span>(ceventmsg, data.InsertData.Ceventmsg)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>		ceventname = <span style="color:#8be9fd;font-style:italic">append</span>(ceventname, data.InsertData.Ceventname)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>		ceventtype = <span style="color:#8be9fd;font-style:italic">append</span>(ceventtype, data.InsertData.Ceventtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>		cflowdir = <span style="color:#8be9fd;font-style:italic">append</span>(cflowdir, data.InsertData.Cflowdir)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>		cobject = <span style="color:#8be9fd;font-style:italic">append</span>(cobject, data.InsertData.Cobject)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>		coperation = <span style="color:#8be9fd;font-style:italic">append</span>(coperation, data.InsertData.Coperation)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>		csrcip = <span style="color:#8be9fd;font-style:italic">append</span>(csrcip, data.InsertData.Csrcip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>		csrclogtype = <span style="color:#8be9fd;font-style:italic">append</span>(csrclogtype, data.InsertData.Csrclogtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>		logtype_tag = <span style="color:#8be9fd;font-style:italic">append</span>(logtype_tag, data.InsertData.LogypeTag)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>		manufacturer = <span style="color:#8be9fd;font-style:italic">append</span>(manufacturer, data.InsertData.Manufacturer)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>		reason = <span style="color:#8be9fd;font-style:italic">append</span>(reason, data.InsertData.Reason)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>		iappprotocol = <span style="color:#8be9fd;font-style:italic">append</span>(iappprotocol, data.InsertData.Iappprotocol)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>		icollecttype = <span style="color:#8be9fd;font-style:italic">append</span>(icollecttype, data.InsertData.Icollecttype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>		idstport = <span style="color:#8be9fd;font-style:italic">append</span>(idstport, data.InsertData.Idstport)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>		ieventlevel = <span style="color:#8be9fd;font-style:italic">append</span>(ieventlevel, data.InsertData.Ieventlevel)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>		imergecount = <span style="color:#8be9fd;font-style:italic">append</span>(imergecount, data.InsertData.Imergecount)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>		iprotocol = <span style="color:#8be9fd;font-style:italic">append</span>(iprotocol, data.InsertData.Iprotocol)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>		isrcport = <span style="color:#8be9fd;font-style:italic">append</span>(isrcport, data.InsertData.Iprotocol)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>		lduration = <span style="color:#8be9fd;font-style:italic">append</span>(lduration, data.InsertData.Lduration)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>		lrecivepack = <span style="color:#8be9fd;font-style:italic">append</span>(lrecivepack, data.InsertData.Lrecivepack)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>		lsendpack = <span style="color:#8be9fd;font-style:italic">append</span>(lsendpack, data.InsertData.Lsendpack)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>		request_body_len = <span style="color:#8be9fd;font-style:italic">append</span>(request_body_len, data.InsertData.RequestBodyLen)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>		response_body_len = <span style="color:#8be9fd;font-style:italic">append</span>(response_body_len, data.InsertData.ResponseBodyLen)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>		lendtime = <span style="color:#8be9fd;font-style:italic">append</span>(lendtime, data.InsertData.Lendtime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>		lid = <span style="color:#8be9fd;font-style:italic">append</span>(lid, data.InsertData.Lid)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>		loccurtime = <span style="color:#8be9fd;font-style:italic">append</span>(loccurtime, data.InsertData.Loccurtime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>		lrecepttime = <span style="color:#8be9fd;font-style:italic">append</span>(lrecepttime, data.InsertData.Lrecepttime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span>		lstartime = <span style="color:#8be9fd;font-style:italic">append</span>(lstartime, data.InsertData.Lstartime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span>	}
</span></span></code></pre></div><p>å†™å…¥çš„æ—¶å€™ä¹Ÿæ˜¯éœ€è¦å…ˆè§£æä¸ºbatchï¼Œç„¶åå†å°†æˆ‘ä»¬é¢„å…ˆå®šä¹‰å¥½çš„å­—æ®µæ˜ å°„åˆ°batchçš„columnä¸Šï¼Œæœ€åå†é€šè¿‡Sendå†™å…¥åˆ°ckã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">insert</span>(conn driver.Conn, batch <span style="color:#8be9fd">int</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>	start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	ctx <span style="color:#ff79c6">:=</span> context.<span style="color:#50fa7b">Background</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	bt, err <span style="color:#ff79c6">:=</span> conn.<span style="color:#50fa7b">PrepareBatch</span>(ctx, data.InsertSql)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>		log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	s <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">0</span>).<span style="color:#50fa7b">Append</span>(ccollectorip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">1</span>).<span style="color:#50fa7b">Append</span>(cdevip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">2</span>).<span style="color:#50fa7b">Append</span>(cdevtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">3</span>).<span style="color:#50fa7b">Append</span>(cdstip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">4</span>).<span style="color:#50fa7b">Append</span>(ceventmsg)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">5</span>).<span style="color:#50fa7b">Append</span>(ceventname)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">6</span>).<span style="color:#50fa7b">Append</span>(ceventtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">7</span>).<span style="color:#50fa7b">Append</span>(cflowdir)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">8</span>).<span style="color:#50fa7b">Append</span>(cobject)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">9</span>).<span style="color:#50fa7b">Append</span>(coperation)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">10</span>).<span style="color:#50fa7b">Append</span>(csrcip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">11</span>).<span style="color:#50fa7b">Append</span>(csrclogtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">12</span>).<span style="color:#50fa7b">Append</span>(logtype_tag)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">13</span>).<span style="color:#50fa7b">Append</span>(manufacturer)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">14</span>).<span style="color:#50fa7b">Append</span>(reason)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">15</span>).<span style="color:#50fa7b">Append</span>(iappprotocol)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">16</span>).<span style="color:#50fa7b">Append</span>(icollecttype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">17</span>).<span style="color:#50fa7b">Append</span>(idstport)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">18</span>).<span style="color:#50fa7b">Append</span>(ieventlevel)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">19</span>).<span style="color:#50fa7b">Append</span>(imergecount)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">20</span>).<span style="color:#50fa7b">Append</span>(iprotocol)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">21</span>).<span style="color:#50fa7b">Append</span>(isrcport)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">22</span>).<span style="color:#50fa7b">Append</span>(lduration)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">23</span>).<span style="color:#50fa7b">Append</span>(lrecivepack)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">24</span>).<span style="color:#50fa7b">Append</span>(lsendpack)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">25</span>).<span style="color:#50fa7b">Append</span>(request_body_len)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">26</span>).<span style="color:#50fa7b">Append</span>(response_body_len)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">27</span>).<span style="color:#50fa7b">Append</span>(lendtime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">28</span>).<span style="color:#50fa7b">Append</span>(lid)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">29</span>).<span style="color:#50fa7b">Append</span>(loccurtime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">30</span>).<span style="color:#50fa7b">Append</span>(lrecepttime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span>	bt.<span style="color:#50fa7b">Column</span>(<span style="color:#bd93f9">31</span>).<span style="color:#50fa7b">Append</span>(lstartime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span>	e <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span>	bt.<span style="color:#50fa7b">Send</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span>	end <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span><span>	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;è®°å½•æ•°: %d, è€—æ—¶: %d, å¾ªç¯å‡†å¤‡è€—æ—¶: %d, é€Ÿç‡: %d(æ¡/ç§’) \n&#34;</span>, batch, (end<span style="color:#ff79c6">-</span>start)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, (e<span style="color:#ff79c6">-</span>s)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, <span style="color:#8be9fd;font-style:italic">int64</span>(batch<span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000000</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000</span>)<span style="color:#ff79c6">/</span>(end<span style="color:#ff79c6">-</span>start))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span><span>}
</span></span></code></pre></div><p>æµ‹è¯•ç»“æœï¼š</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/clickhouse-go3.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/clickhouse-go4.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p>ä»æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œckçš„å†™å…¥é€Ÿåº¦å·®ä¸å¤šåœ¨æ¯ç§’6wåˆ°7ä¸‡ä¹‹é—´ï¼Œå¹³å‡åœ¨6.5w/sï¼Œå¯¹æ¯”æœ¬æœºçš„apiæµ‹è¯•ç»“æœç•¥æœ‰æå‡ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨æ‰’äº†ä¸€äº›æ–‡æ¡£å’Œçœ‹äº†ä¸€ä¸‹åº•å±‚å¸¦å—åï¼Œå‘ç°é€šè¿‡å­—æ®µå†™å…¥è¿™æ ·åšçš„å¥½å¤„æ˜¯é¿å…äº†è¡Œåˆ—çš„è½¬æ¢ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ckæ˜¯ä¸€ä¸ªåˆ—å¼å­˜å‚¨æ•°æ®åº“ï¼Œå¹¶ä¸”å› ä¸ºæˆ‘ä»¬é¢„å…ˆå®šä¹‰å¥½äº†å­—æ®µçš„ç±»å‹ï¼Œåœ¨æ•°æ®å¤„ç†ä¸Šä¹Ÿé¿å…äº†ä¸€äº›ç±»å‹åˆ¤æ–­å’Œåå°„ã€‚</p>
<h3 id="ch-gohttpsgithubcomclickhousech-go"><a href="https://github.com/ClickHouse/ch-go" target="_blank">ch-go</a><a class="anchorjs-link" href="#ch-gohttpsgithubcomclickhousech-go"></a></h3><p>å»ºç«‹è¿æ¥éƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œæˆ‘ä»¬å°±ä¸åœ¨ç»†çœ‹äº†ï¼Œç›´æ¥æ¥çœ‹å†™å…¥çš„é˜¶æ®µ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">insert</span>(conn <span style="color:#ff79c6">*</span>ch.Client, batch <span style="color:#8be9fd">int</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>	start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	<span style="color:#8be9fd;font-style:italic">var</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>		ccollectorip, cdevip, cdevtype, cdstip, ceventmsg, ceventname, ceventtype, cflowdir, cobject, coperation, csrcip, csrclogtype,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>		logtype_tag, manufacturer, reason proto.ColStr
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>		iappprotocol, icollecttype, idstport, ieventlevel, imergecount, iprotocol, isrcport                                       proto.ColInt32
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>		lduration, lrecivepack, lsendpack, request_body_len, response_body_len, lendtime, lid, loccurtime, lrecepttime, lstartime proto.ColInt64
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; batch; i<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>		ccollectorip.<span style="color:#50fa7b">Append</span>(data.InsertData.Ccollectorip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>		cdevip.<span style="color:#50fa7b">Append</span>(data.InsertData.Cdevip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>		cdevtype.<span style="color:#50fa7b">Append</span>(data.InsertData.Cdevtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>		cdstip.<span style="color:#50fa7b">Append</span>(data.InsertData.Cdstip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>		ceventmsg.<span style="color:#50fa7b">Append</span>(data.InsertData.Ceventmsg)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>		ceventname.<span style="color:#50fa7b">Append</span>(data.InsertData.Ceventname)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>		ceventtype.<span style="color:#50fa7b">Append</span>(data.InsertData.Ceventtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>		cflowdir.<span style="color:#50fa7b">Append</span>(data.InsertData.Cflowdir)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>		cobject.<span style="color:#50fa7b">Append</span>(data.InsertData.Cobject)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>		coperation.<span style="color:#50fa7b">Append</span>(data.InsertData.Coperation)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>		csrcip.<span style="color:#50fa7b">Append</span>(data.InsertData.Csrcip)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>		csrclogtype.<span style="color:#50fa7b">Append</span>(data.InsertData.Csrclogtype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>		logtype_tag.<span style="color:#50fa7b">Append</span>(data.InsertData.LogypeTag)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>		manufacturer.<span style="color:#50fa7b">Append</span>(data.InsertData.Manufacturer)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>		reason.<span style="color:#50fa7b">Append</span>(data.InsertData.Reason)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>		iappprotocol.<span style="color:#50fa7b">Append</span>(data.InsertData.Iappprotocol)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>		icollecttype.<span style="color:#50fa7b">Append</span>(data.InsertData.Icollecttype)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>		idstport.<span style="color:#50fa7b">Append</span>(data.InsertData.Idstport)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>		ieventlevel.<span style="color:#50fa7b">Append</span>(data.InsertData.Ieventlevel)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>		imergecount.<span style="color:#50fa7b">Append</span>(data.InsertData.Imergecount)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>		iprotocol.<span style="color:#50fa7b">Append</span>(data.InsertData.Iprotocol)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>		isrcport.<span style="color:#50fa7b">Append</span>(data.InsertData.Isrcport)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>		lduration.<span style="color:#50fa7b">Append</span>(data.InsertData.Lduration)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>		lrecivepack.<span style="color:#50fa7b">Append</span>(data.InsertData.Lrecivepack)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>		lsendpack.<span style="color:#50fa7b">Append</span>(data.InsertData.Lsendpack)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>		request_body_len.<span style="color:#50fa7b">Append</span>(data.InsertData.RequestBodyLen)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>		response_body_len.<span style="color:#50fa7b">Append</span>(data.InsertData.ResponseBodyLen)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>		lendtime.<span style="color:#50fa7b">Append</span>(data.InsertData.Lendtime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>		lid.<span style="color:#50fa7b">Append</span>(data.InsertData.Lid)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>		loccurtime.<span style="color:#50fa7b">Append</span>(data.InsertData.Loccurtime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span>		lrecepttime.<span style="color:#50fa7b">Append</span>(data.InsertData.Lrecepttime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span>		lstartime.<span style="color:#50fa7b">Append</span>(data.InsertData.Lstartime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span>	input <span style="color:#ff79c6">:=</span> proto.Input{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span>		{Name: <span style="color:#f1fa8c">&#34;ccollectorip&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>ccollectorip},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span><span>		{Name: <span style="color:#f1fa8c">&#34;cdevip&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>cdevip},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span><span>		{Name: <span style="color:#f1fa8c">&#34;cdevtype&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>cdevtype},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span><span>		{Name: <span style="color:#f1fa8c">&#34;cdstip&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>cdstip},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span><span>		{Name: <span style="color:#f1fa8c">&#34;ceventmsg&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>ceventmsg},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span><span>		{Name: <span style="color:#f1fa8c">&#34;ceventname&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>ceventname},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span><span>		{Name: <span style="color:#f1fa8c">&#34;ceventtype&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>ceventtype},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span><span>		{Name: <span style="color:#f1fa8c">&#34;cflowdir&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>cflowdir},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span><span>		{Name: <span style="color:#f1fa8c">&#34;cobject&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>cobject},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span><span>		{Name: <span style="color:#f1fa8c">&#34;coperation&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>coperation},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span><span>		{Name: <span style="color:#f1fa8c">&#34;csrcip&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>csrcip},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span><span>		{Name: <span style="color:#f1fa8c">&#34;csrclogtype&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>csrclogtype},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span><span>		{Name: <span style="color:#f1fa8c">&#34;logtype_tag&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>logtype_tag},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57</span><span>		{Name: <span style="color:#f1fa8c">&#34;manufacturer&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>manufacturer},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58</span><span>		{Name: <span style="color:#f1fa8c">&#34;reason&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>reason},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59</span><span>		{Name: <span style="color:#f1fa8c">&#34;iappprotocol&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>iappprotocol},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60</span><span>		{Name: <span style="color:#f1fa8c">&#34;icollecttype&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>icollecttype},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61</span><span>		{Name: <span style="color:#f1fa8c">&#34;idstport&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>idstport},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62</span><span>		{Name: <span style="color:#f1fa8c">&#34;ieventlevel&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>ieventlevel},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63</span><span>		{Name: <span style="color:#f1fa8c">&#34;imergecount&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>imergecount},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64</span><span>		{Name: <span style="color:#f1fa8c">&#34;iprotocol&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>iprotocol},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65</span><span>		{Name: <span style="color:#f1fa8c">&#34;isrcport&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>isrcport},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66</span><span>		{Name: <span style="color:#f1fa8c">&#34;lduration&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>lduration},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67</span><span>		{Name: <span style="color:#f1fa8c">&#34;lrecivepack&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>lrecivepack},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68</span><span>		{Name: <span style="color:#f1fa8c">&#34;lsendpack&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>lsendpack},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69</span><span>		{Name: <span style="color:#f1fa8c">&#34;request_body_len&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>request_body_len},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70</span><span>		{Name: <span style="color:#f1fa8c">&#34;response_body_len&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>response_body_len},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71</span><span>		{Name: <span style="color:#f1fa8c">&#34;lendtime&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>lendtime},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72</span><span>		{Name: <span style="color:#f1fa8c">&#34;lid&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>lid},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73</span><span>		{Name: <span style="color:#f1fa8c">&#34;loccurtime&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>loccurtime},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74</span><span>		{Name: <span style="color:#f1fa8c">&#34;lrecepttime&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>lrecepttime},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75</span><span>		{Name: <span style="color:#f1fa8c">&#34;lstartime&#34;</span>, Data: <span style="color:#ff79c6">&amp;</span>lstartime},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77</span><span>	s <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> conn.<span style="color:#50fa7b">Do</span>(context.<span style="color:#50fa7b">Background</span>(), ch.Query{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79</span><span>		Body:  insertSql,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80</span><span>		Input: input,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81</span><span>	}); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82</span><span>		log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84</span><span>	end <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85</span><span>	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;è®°å½•æ•°: %d, è€—æ—¶: %d, å¾ªç¯å‡†å¤‡è€—æ—¶: %d, é€Ÿç‡: %d(æ¡/ç§’) \n&#34;</span>, batch, (end<span style="color:#ff79c6">-</span>start)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, (s<span style="color:#ff79c6">-</span>start)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, <span style="color:#8be9fd;font-style:italic">int64</span>(batch<span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000000</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000</span>)<span style="color:#ff79c6">/</span>(end<span style="color:#ff79c6">-</span>start))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86</span><span>}
</span></span></code></pre></div><p>å†™å…¥çš„å¤„ç†çœ‹èµ·æ¥è·Ÿclickhouse-goçš„å­—æ®µå†™å…¥å¾ˆåƒï¼Œä¹Ÿæ˜¯å…ˆå®šä¹‰å¥½äº†æ•°æ®ç»“æ„ï¼ŒæŠŠç»“æ„å’Œå­—æ®µæ˜ å°„åˆ°ä¸€èµ·ï¼Œæœ€ç»ˆé€šè¿‡Doçš„æ–¹æ³•å†™å…¥ckã€‚</p>
<p>æµ‹è¯•ç»“æœï¼š</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/ch-go1.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/ch-go2.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p>ch-goçš„å†™å…¥æ€§èƒ½è·Ÿclickhouse-goçš„æ€§èƒ½å¾ˆæ¥è¿‘ï¼Œä¹Ÿæ˜¯å¹³å‡6.7w-6.8w/sï¼Œä½†æ˜¯ch-goçš„å†™å…¥é€Ÿç‡éå¸¸å¹³ç¨³ï¼Œç›¸æ¯”æ¥çœ‹ï¼Œåœ¨å¤§æ•°æ®é‡å†™å…¥çš„æƒ…å†µä¸‹ch-goæ˜¯æ¯”è¾ƒç¨³å®šçš„ã€‚</p>
<h3 id="databasesqldatabasesql"><a href="/database/sql">database/sql</a><a class="anchorjs-link" href="#databasesqldatabasesql"></a></h3><p>sqlåº“åœ¨è¿æ¥ckçš„æ—¶å€™éœ€è¦ä¸€ä¸ªckçš„å¼•æ“ï¼Œç”¨çš„ä¹Ÿæ˜¯clickhouse-goçš„å¼•æ“ï¼Œæœ¬æ¥æƒ³ç”¨v2ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯åœ¨è¿æ¥çš„è¿‡ç¨‹ä¸­å‡ºç°äº†è¿™ä¸ªæŠ¥é”™ï¼š</p>
<p><em><strong>code: 81, message: Database default doesn&rsquo;t exist</strong></em></p>
<p>å³ä½¿æ•°æ®åº“å­˜åœ¨ä¹Ÿä¼šæŠ¥è¿™ä¸ªé”™è¯¯ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œæµ‹è¯•çš„æ—¶å€™é€‰äº†v1ç‰ˆæœ¬çš„clickhouse-goå¼•æ“ï¼Œä»è¿æ¥çœ‹å°±èƒ½å¤ŸçŸ¥é“ä½¿ç”¨äº†clickhouse-goçš„å¼•æ“ï¼Œå†™å…¥çš„æ—¶å€™æ˜¯ä½¿ç”¨äº†äº‹åŠ¡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>	conn <span style="color:#ff79c6">:=</span> clickhouse.<span style="color:#50fa7b">OpenDB</span>(<span style="color:#ff79c6">&amp;</span>clickhouse.Options{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>		Addr: []<span style="color:#8be9fd">string</span>{<span style="color:#ff79c6">*</span>host},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>		Auth: clickhouse.Auth{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>			Database: <span style="color:#ff79c6">*</span>db,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>			Username: <span style="color:#ff79c6">*</span>user,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>			Password: <span style="color:#ff79c6">*</span>pass,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>		},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>		Settings: clickhouse.Settings{
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>			<span style="color:#f1fa8c">&#34;max_execution_time&#34;</span>: <span style="color:#bd93f9">60</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>		},
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>		DialTimeout: <span style="color:#bd93f9">5</span> <span style="color:#ff79c6">*</span> time.Second,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>		Debug:       <span style="color:#ff79c6">true</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>	})
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">insert</span>(conn <span style="color:#ff79c6">*</span>sql.DB, batch <span style="color:#8be9fd">int</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>	start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	tx, err <span style="color:#ff79c6">:=</span> conn.<span style="color:#50fa7b">Begin</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>		log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	stmt, err <span style="color:#ff79c6">:=</span> tx.<span style="color:#50fa7b">Prepare</span>(data.InsertSql)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>		log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>	s <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>	<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; batch; i<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>		_, err <span style="color:#ff79c6">:=</span> stmt.<span style="color:#50fa7b">Exec</span>(data.InsertData.Ccollectorip, data.InsertData.Cdevip, data.InsertData.Cdevtype, data.InsertData.Cdstip, data.InsertData.Ceventmsg,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>			data.InsertData.Ceventname, data.InsertData.Ceventtype, data.InsertData.Cflowdir, data.InsertData.Cobject, data.InsertData.Coperation,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>			data.InsertData.Csrcip, data.InsertData.Csrclogtype, data.InsertData.LogypeTag, data.InsertData.Manufacturer, data.InsertData.Reason,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>			data.InsertData.Iappprotocol, data.InsertData.Icollecttype, data.InsertData.Idstport, data.InsertData.Ieventlevel, data.InsertData.Imergecount,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>			data.InsertData.Iprotocol, data.InsertData.Isrcport, data.InsertData.Lduration, data.InsertData.Lrecivepack, data.InsertData.Lsendpack,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>			data.InsertData.RequestBodyLen, data.InsertData.ResponseBodyLen, data.InsertData.Lendtime, data.InsertData.Lid, data.InsertData.Loccurtime,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>			data.InsertData.Lrecepttime, data.InsertData.Lstartime)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>		<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>			log.<span style="color:#50fa7b">Fatal</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>		}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>	e <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>	tx.<span style="color:#50fa7b">Commit</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>	stmt.<span style="color:#50fa7b">Close</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>	end <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;è®°å½•æ•°: %d, è€—æ—¶: %d, å¾ªç¯å‡†å¤‡è€—æ—¶: %d, é€Ÿç‡: %d(æ¡/ç§’) \n&#34;</span>, batch, (end<span style="color:#ff79c6">-</span>start)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, (e<span style="color:#ff79c6">-</span>s)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, <span style="color:#8be9fd;font-style:italic">int64</span>(batch<span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000000</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000</span>)<span style="color:#ff79c6">/</span>(end<span style="color:#ff79c6">-</span>start))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>}
</span></span></code></pre></div><p>æµ‹è¯•ç»“æœï¼š</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/sql1.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/sql2.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p>ä»æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œæ¯ç§’å†™å…¥çš„é€Ÿåº¦å¹³å‡ä¸º5.5w/sï¼Œæ¶ˆè€—æ—¶é—´å¤šçš„åœ°æ–¹åœ¨Execçš„æ–¹æ³•ä¸Šï¼Œä¹Ÿå°±æ˜¯æ•°æ®å¤„ç†ä¸Šã€‚</p>
<h3 id="sqlxhttpsgithubcomjmoironsqlx"><a href="https://github.com/jmoiron/sqlx" target="_blank">sqlx</a><a class="anchorjs-link" href="#sqlxhttpsgithubcomjmoironsqlx"></a></h3><p>sqlxæ˜¯åœ¨æ ‡å‡†åº“database/sqlä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œæä¾›äº†è‡ªå·±çš„ä¸€äº›æŸ¥è¯¢æˆ–äº‹åŠ¡çš„æ–¹æ³•ï¼Œè¿æ¥ä¹Ÿéå¸¸ç®€å•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>	conn, err <span style="color:#ff79c6">:=</span> sqlx.<span style="color:#50fa7b">Connect</span>(<span style="color:#f1fa8c">&#34;clickhouse&#34;</span>, fmt.<span style="color:#50fa7b">Sprintf</span>(<span style="color:#f1fa8c">&#34;tcp://%s?username=%s&amp;password=%s&amp;database=%s&amp;debug=false&#34;</span>, <span style="color:#ff79c6">*</span>host, <span style="color:#ff79c6">*</span>user, <span style="color:#ff79c6">*</span>pass, <span style="color:#ff79c6">*</span>db))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>		<span style="color:#8be9fd;font-style:italic">panic</span>(<span style="color:#50fa7b">any</span>(err))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>	}
</span></span></code></pre></div><p>æ•°æ®çš„å†™å…¥å°±è·Ÿdatabase/sqlæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ€§èƒ½è·Ÿå…¶å¾ˆåƒï¼Œåœ¨è¿™å°±ä¸å¤šåšèµ˜è¿°äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚</p>
<h3 id="gormhttpsgithubcomgo-gormgorm"><a href="https://github.com/go-gorm/gorm" target="_blank">Gorm</a><a class="anchorjs-link" href="#gormhttpsgithubcomgo-gormgorm"></a></h3><p>gormæ˜¯ä¸€ä¸ªåº”ç”¨å¹¿æ³›çš„golang ormæ¡†æ¶ï¼Œå› å…¶åŠŸèƒ½å…¨ï¼Œæ”¯æŒåŸç”Ÿsqlï¼Œæ–‡æ¡£å¥å…¨è€Œå¤‡å—å¥½è¯„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹gormåœ¨ckå†™å…¥æ–¹é¢çš„æ€§èƒ½å¦‚ä½•ã€‚gormçš„è¿æ¥å’Œå†™å…¥ä¹Ÿéå¸¸ç®€å•å’Œæš´åŠ›ï¼Œå°±ä¸€ä¸ªCreatæ–¹æ³•å°±æå®šï¼Œå¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œæ›´åŠ å–œæ¬¢è¿™ç§ç®€æ´åªè®°å¾—æ–¹å¼ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>	dsn <span style="color:#ff79c6">:=</span> fmt.<span style="color:#50fa7b">Sprintf</span>(<span style="color:#f1fa8c">&#34;clickhouse://%s:%s@%s/%s&#34;</span>, <span style="color:#ff79c6">*</span>user, <span style="color:#ff79c6">*</span>pass, <span style="color:#ff79c6">*</span>host, <span style="color:#ff79c6">*</span>db)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>	db, err <span style="color:#ff79c6">:=</span> gorm.<span style="color:#50fa7b">Open</span>(clickhouse.<span style="color:#50fa7b">Open</span>(dsn), <span style="color:#ff79c6">&amp;</span>gorm.Config{})
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>	<span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>		<span style="color:#8be9fd;font-style:italic">panic</span>(<span style="color:#50fa7b">any</span>(err))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>	}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">insert</span>(db <span style="color:#ff79c6">*</span>gorm.DB, batch <span style="color:#8be9fd">int</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>	start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	result <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">make</span>([]data.Data, <span style="color:#bd93f9">0</span>, batch)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">100000</span>; i<span style="color:#ff79c6">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>		result = <span style="color:#8be9fd;font-style:italic">append</span>(result, data.InsertData)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	db.<span style="color:#50fa7b">Table</span>(<span style="color:#f1fa8c">&#34;event&#34;</span>).<span style="color:#50fa7b">Create</span>(<span style="color:#ff79c6">&amp;</span>result)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	end <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">UnixNano</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;è®°å½•æ•°: %d, è€—æ—¶: %d, é€Ÿç‡: %d(æ¡/ç§’) \n&#34;</span>, <span style="color:#bd93f9">100000</span>, (end<span style="color:#ff79c6">-</span>start)<span style="color:#ff79c6">/</span><span style="color:#bd93f9">1e6</span>, <span style="color:#8be9fd;font-style:italic">int64</span>(<span style="color:#bd93f9">100000</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000000</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">1000</span>)<span style="color:#ff79c6">/</span>(end<span style="color:#ff79c6">-</span>start))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>}
</span></span></code></pre></div><p>æµ‹è¯•ç»“æœï¼š</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="img/gorm.png" data-action="zoom" alt=""  class="lazyload">
  </a>
  
</figure></p>
<p>ä»æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œgormçš„ckå†™å…¥æ€§èƒ½å´ä¸å°½äººæ„ï¼Œåªèƒ½åšåˆ°4w/sï¼Œä¸è¿‡ä¹Ÿæ²¡æœ‰å¯¹gormæŠ±æœ‰å¤ªå¤§å¸Œæœ›ï¼Œå› ä¸ºgormçš„ä¼˜åŠ¿åœ¨äºä¾¿åˆ©çš„apiï¼Œåœ¨é¡¹ç›®ä¸­ä¹Ÿç”¨gormå¯¹mysqlè¿›è¡ŒæŸ¥è¯¢å’Œå†™å…¥ï¼Œä¹Ÿæ˜¯éå¸¸ä¸æ»‘ï¼Œæ€§èƒ½å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚å¯¹äºckæ€§èƒ½ä½ï¼Œä¹Ÿè®¸æ˜¯è·Ÿgormçš„ckç¤¾åŒºä¸æ˜¯å¾ˆæ´»è·ƒï¼Œå…³æ³¨çš„é‡ç‚¹ä¸åœ¨è¿™ä¸Šé¢ã€‚</p>
<h2 id="æµ‹è¯•ç»“æœ">æµ‹è¯•ç»“æœ<a class="anchorjs-link" href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c"></a></h2><table>
<thead>
<tr>
<th>clickhouse-go</th>
<th>ch-go</th>
<th>database/sql</th>
<th>Sql</th>
<th>grom</th>
</tr>
</thead>
<tbody>
<tr>
<td>6.5w/s (column)</td>
<td>6.7w/s</td>
<td>5.5w/s</td>
<td>6w/s</td>
<td>4w/s</td>
</tr>
</tbody>
</table>
<h2 id="ç»“è®º">ç»“è®º<a class="anchorjs-link" href="#%e7%bb%93%e8%ae%ba"></a></h2><p>ä»ä»¥ä¸Šçš„æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œå®˜æ–¹æ¨èçš„clickhouse-goå’Œch-goæ›´å…·æœ‰ä¼˜åŠ¿ï¼Œæ‰€ä»¥é€‰æ‹©å…¶ä¸­ä»»æ„ä¸€ç§å‡å¯ï¼Œä½†å¦‚æœåœ¨å­—æ®µæ•°é‡å°çš„æƒ…å†µä¸‹ï¼Œç¬”è€…ä»»åŠ¡ch-goçš„å†™å…¥æ›´å…·æœ‰ä¼˜åŠ¿ï¼Œæ¯•ç«Ÿclickhouse-goæ›´ä¸“æ³¨äºä½ååé‡å’Œæ•°æ®åˆ†ææŸ¥è¯¢ã€‚å› æ­¤è¿™ä¸¤ä¸ªåº“éœ€è¦çœ‹è‡ªå·±çš„ä½¿ç”¨è€Œå®šã€‚</p>
<p>ä»¥ä¸Šæµ‹è¯•å¹¶ä¸ä»£è¡¨ä»»ä½•æƒ…å†µä¸‹çš„ckå†™å…¥æ€§èƒ½ï¼Œå…·ä½“æƒ…å†µè¿˜éœ€è¦è‡ªå·±äº²è‡ªè¯•è¿‡æ‰è¦å†³å®šã€‚</p>


        <hr style="visibility: hidden;" />
        <ul class="pager">
          
          
          <li class="next">
            <a href="/posts/goland_remote_connect/" data-toggle="tooltip" data-placement="top" title="Goland è¿œç¨‹å¼€å‘">
              Next<br>
              <span>Goland è¿œç¨‹å¼€å‘</span>
            </a>
          </li>
          
        </ul>
        <hr style="visibility: hidden;" />

        
        






      </div>

      
      
      
      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              sidebar-container">

        
        
        <section>
  
  
  <hr class="hidden-sm hidden-xs">
  
  <h5>FEATURED TAGS</h5>
  <div class="tags">
    
    <a href="/tags/chatgpt/">chatgpt</a>
    
    <a href="/tags/clickhouse/">clickhouse</a>
    
    <a href="/tags/goland/">goland</a>
    
    <a href="/tags/golang/">golang</a>
    
    <a href="/tags/remote/">remote</a>
    
    <a href="/tags/tensorflow/">tensorflow</a>
    
    <a href="/tags/vercel/">vercel</a>
    
  </div>
</section>

        
        

      </div>
    </div>
  </div>
</article>



  
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        <ul class="list-inline text-center"></ul>

        <p class="copyright text-muted">
          Copyright &copy; JARVIS 2023  
          <br>
          Powered by <a href="https://gohugo.io">Hugo</a>
        </p>
      </div>
    </div>
  </div>
</footer>

<script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js crossorigin="anonymous"></script>



<script src="/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js"></script>


<script src=/js/simple-jekyll-search.min.js></script>


<script src="/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js"></script>










<script async src="https://www.googletagmanager.com/gtag/js?id=G-W7FHK7X33Z"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-W7FHK7X33Z', { 'anonymize_ip': false });
}
</script>




<script src="/zoomjs/zoom.min.js"></script>

</body>

</html>